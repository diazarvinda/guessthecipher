<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess the Cipher Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            margin-top: 50px;
        }

        .form-control,
        .form-select {
            margin-bottom: 15px;
        }

        .result {
            margin-top: 30px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="text-center">Guess the Cipher Game</h1>
        <form id="textForm" method="post" class="mt-4" onsubmit="return validateInput()">
            <div class="mb-3">
                <label for="user_text" class="form-label">Enter your text (at least 4 letters):</label>
                <input type="text" id="user_text" name="user_text" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">Encrypt and Guess</button>
        </form>

        {% if encrypted_text %}
        <div class="result">
            <h2>Encrypted Text</h2>
            <p><strong>{{ encrypted_text }}</strong></p>
            <h3>Guess the Cipher Used</h3>
            <form id="guessForm">
                {% for option in options %}
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="guess" id="{{ option }}" value="{{ option }}"
                        required>
                    <label class="form-check-label" for="{{ option }}">
                        {{ option }}
                    </label>
                </div>
                {% endfor %}
                <input type="hidden" name="correct_cipher" value="{{ correct_cipher }}">
                <input type="hidden" name="explanation" value="{{ explanation|join(';') }}">
                <button type="button" class="btn btn-success mt-3" onclick="submitGuess()">Submit Guess</button>
            </form>
        </div>
        {% endif %}
    </div>

    <!-- Modal -->
    <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resultModalLabel">Result</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="resultMessage"></p>
                    <ul id="explanationList"></ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        function validateInput() {
            const userText = document.getElementById('user_text').value;
            const letters = userText.match(/[a-zA-Z]/g) || [];
            const letterCount = letters.length;
            if (letterCount < 4) {
                alert('Please enter at least 4 letters.');
                return false;
            }
            return true;
        }

        function submitGuess() {
            const form = document.getElementById('guessForm');
            const formData = new FormData(form);

            fetch('/game', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('resultMessage').innerText = data.message;
                    const explanationList = document.getElementById('explanationList');
                    explanationList.innerHTML = '';
                    data.explanation.forEach(step => {
                        const li = document.createElement('li');
                        li.textContent = step;
                        explanationList.appendChild(li);
                    });
                    const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
                    resultModal.show();
                });
        }
    </script>
</body>

</html>